@model ProposalModel

@using iBudget.Framework

@{
    ViewData["Title"] = "Cadastro de orçamento";
    string itemsJson = Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.ItemsFull);
}

@section Scripts
{
    <script src="@Url.Content("~/js/proposalUtils.js")"></script>
    <script src="@Url.Content("~/js/deleteElementConfirmationHelper.js")"></script>
    <script src="@Url.Content("~/js/submitHelper.js")"></script>
}

<script>
    var items = @Html.Raw(itemsJson);
</script>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            @using (Html.BeginForm("Create", "Proposal", FormMethod.Post, new { @class = "needs-validation" }))
            {
                <div class="mb-3 text-start">
                    <label asp-for="PersonId" class="form-label"></label>
                    <select asp-for="PersonId" class="form-select" asp-items="@ViewBag.People">
                        <option disabled selected value="@(SelectDefault.Nenhum)">@(SelectDefault.Nenhum.ToString())</option>
                    </select>
                    <span asp-validation-for="PersonId" class="text-danger"></span>
                </div>

                <div class="mb-3 text-start">
                    <label for="ItemList" class="form-label">Item</label>
                    <select id="ItemList" class="form-select" asp-items="@ViewBag.Items" onchange="javascript:selectionChange(this)">
                        <option disabled selected value="@((int)SelectDefault.Nenhum)">@(SelectDefault.Nenhum.ToString())</option>
                    </select>
                </div>

                <div class="mb-3 text-start">
                    <label asp-for="Discount" class="form-label"></label>
                    <input id="discount" asp-for="Discount" type="number" step="0.01" onchange="calculateTotalValue()" class="form-control" placeholder=""
                        value="0">
                    <span asp-validation-for="Discount" class="text-danger"></span>
                </div>

                <hr class="my-4">

                <div class="table-responsive mb-4">
                    <table id="proposalContentTable" class="table table-striped">
                        <thead class="">
                            <tr>
                                <th class="text-center">ID Orçamento</th>
                                <th class="text-center">ID Item</th>
                                <th class="text-center">Item</th>
                                <th class="text-center">Valor</th>
                                <th class="text-center">Quantidade</th>
                                <th class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="table-rows">
                            @*dinamically*@
                            <tr>
                                <td colspan="3" class="text-end fw-bold">Total:</td>
                                <td id="total-value-cell" class="text-center fw-bold">R$ 0.00</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <span asp-validation-for="ProposalContent" class="text-danger"></span>
                </div>

                <hr class="my-4">

                <div id="submit" class="text-end mb-4">
                    <button class="btn btn-primary btn-lg" type="submit">Salvar</button>
                    <a class="btn btn-secondary btn-lg" asp-action="index">Cancelar</a>
                </div>
            }
        </div>
    </div>
</div>